# Построение ML-продукта для оптимизации классификации заявок на оплату для сервиса Repetit.ru. Резниченко А.Е. @alexrez1989

<b>Цель: </b> Создать ML-продукт, который обрабатывает новые заявки на репетитора и предсказывает, будет ли оплачена заявка. 

<b>Используемые для решения задачи данные:</b>

- orders.feather - основная таблица, содержащая информацию о заявках.
- suitable_teachers.feather - таблица данных, содержащая список учителей по фильтру для конкретной заявки.
- teachers_info.feather - таблица с информацией об учителях.

<b>Задачи:</b>
- Создать модель, которая по имеющимся данным смодет предсказать, оплачена ли заявка. При том заказчик более терпим к ложноположительным предсказаниям, чем к ложноотрицательным (т.е. лучше чтобы модель предсказывала больше оплаченных заявок, чем есть на самом деле, чем наоборот). Важнейшая метрика - ROC-AUC
- Учитывасть проблемы данных, а именно заявки со временем меняются, и важно создать модель, которая будет обрабатывать новые заявки, т.е. следует исключить те признаки, которые не изместны сразу (например, некоторые признаки появляются, когда заказчик уже оплатил заявку)
- Учитывать дублирующие заявки, если по тем или иным причинам клиент хочет связаться с другим репетитором, создаётся новая заявка, так как в одной заявке может быть только один репетитор. Согласно заданию, в случае если оплачена хотя бы одна из дублирующих заявок, то все остальные заявки из данной группы считаются также оплаченными.
- Очистить и подготовить данные. Найти способ использовать дополнительные таблицы (т.е. suitable_teachers и teachers_info).
- Создать синтетические признаки, отобрать важные признаки.

  ### Краткое описание проекта

  В ходе работы над проектом были выполнены следующие основные шаги:
- Ознакомление с данными, агреггирование таблиц
- Работа с пропусками, выбросами и "испорченными" данными. Очистка данных.
- Работа с дублирущими заявками (присвоение им соответствующего целевого значения)
- Удаление лишних столбцов (несущих в себе утечку данных и признанных лишними при предварительном анализе)
- Создание искуственных признаков, общих для всей таблицы.
- Работа с датами и текстовыми данными
- Создание искуственных признаков, требующих предварительного разделение выборки на обучающую и тестовую
- Поиск лучших гиперпараметров для модели
- Отбор признаков с помощью shap
- Окончательное обучение модели и вывод

  
## Итоговый результат

Мы изучили датасет и сумели также вытащить полезные признаки из двух других таблиц данных. Мы сумели выявить группы дублирующих заявок и правильно разметить их целевой признак, таким образом, решив проблему дублирующих заявок. Мы удалили признаки, неизвестные при создании заявок, таким образом частично решив проблему изменяющихся заявок. Мы очистили данные от непригодных для обучения значений, удалили самые разреженные признаки, вытащили признаки из дат и текстовых данных, а также создали дополнительные признаки на основе имеющихся. Кроме того, был произведён отбор признаков с помощью shap и обучена модель с наилучшими параметрами. В качестве финальной была выбрана модель cat_boost.  Мы добились метрик f1 = 0.623,
accuracy = 0.831, 
recall_score = 0.581,
precision_score = 0.671 и 
roc_auc_score = 0.746.
<br>
Кроме того, с помощью shap были выявлены важнейшие для модели признаки.

## Стек
pandas,  numpy, catboost, TfidfVectorizer, sklearn.cluster, GridSearchCV, shap

## Состав проекта:
| **Название файла**  | **Содержание**                            |
|:--------------------|:------------------------------------------|
|(https://github.com/AlexReznickenko/repetit_model/blob/main/rep_final.ipynb)        | основной ноутбук с проектом |
[orders.feather] отсутствует в репозитории         | таблица данных |
[suitable_teachers.feather] отсутствует в репозитории         | таблица данных |
[teachers_info.feather] отсутствует в репозитории         | таблица данных |
| [requirements.txt](https://github.com/AlexReznickenko/repetit_model/blob/main/requirements.txt)    | requirements.txt    
